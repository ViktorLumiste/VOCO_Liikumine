<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Table</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            position: relative;

        }


        th {
            background-color: #f2f2f2;
        }
        td{
            height: 400px; /* Increase the default height for each cell */
        }

        .activity {
            position: absolute;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            padding: 3px;
            width: 95%; /* Adjust width to fit within cell */
            z-index: 1; /* Ensure activities appear above time markers */
        }

        .hour-marker {
            position: absolute;
            width: 100%;
            height: 1px;
            background-color: #ddd;
            z-index: 0; /* Ensure time markers appear below activities */
        }

        .activity button {
            display: block;
            margin-top: 5px;
        }
    </style>
</head>
<body>
<h2>Schedule Table</h2>

<!-- Filter dropdown -->
<label for="filter">Filter:</label>
<select id="filter">
    <option value="">All</option>
    <!-- Options will be dynamically generated here -->
</select>

<table>
    <thead>
    <tr>
        <th>Monday</th>
        <th>Tuesday</th>
        <th>Wednesday</th>
        <th>Thursday</th>
        <th>Friday</th>
    </tr>
    </thead>
    <tbody id="scheduleBody">
    <!-- Schedule data will be displayed here -->
    </tbody>
</table>

<script>
    // Fetch and display schedule data
    fetch('get_schedule.php')
        .then(response => response.json())
        .then(data => {
            const scheduleBody = document.getElementById('scheduleBody');
            const filterDropdown = document.getElementById('filter');
            const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            const activityNames = [];

            // Iterate through data to gather activity names
            daysOfWeek.forEach(day => {
                const activities = data[day];
                activities.forEach(activity => {
                    if (!activityNames.includes(activity.activityName)) {
                        activityNames.push(activity.activityName);
                    }
                });
            });

            // Dynamically generate dropdown options
            activityNames.forEach(activityName => {
                const option = document.createElement('option');
                option.value = activityName;
                option.textContent = activityName;
                filterDropdown.appendChild(option);
            });

            // Display schedule based on filter
            displaySchedule(data);

            // Filter activities based on selected option
            filterDropdown.addEventListener('change', function() {
                displaySchedule(data);
            });
        })
        .catch(error => console.error('Error fetching schedule data:', error));

    // Function to display schedule based on filter
    function displaySchedule(data) {
        const scheduleBody = document.getElementById('scheduleBody');
        const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
        const selectedFilter = document.getElementById('filter').value;

        // Clear existing schedule
        scheduleBody.innerHTML = '';

        daysOfWeek.forEach(day => {
            const activities = data[day];
            const dayColumn = document.createElement('td');
            const timeSlots = {}; // Store occupied time slots for each day

            activities.forEach(activity => {
                // Apply filter if selected
                if (selectedFilter === '' || activity.activityName === selectedFilter) {
                    const startHour = parseInt(activity.start_time.split(':')[0]);
                    const startMinute = parseInt(activity.start_time.split(':')[1]);
                    const endHour = parseInt(activity.end_time.split(':')[0]);
                    const endMinute = parseInt(activity.end_time.split(':')[1]);
                    const top = ((startHour - 8) * 60 + startMinute) / 960 * 100; // Calculate top position
                    const height = ((endHour - startHour) * 60 + endMinute - startMinute) / 960 * 100; // Calculate height

                    // Check for conflicts and adjust position if necessary
                    let adjustedTop = top;
                    while (timeSlots[adjustedTop] && timeSlots[adjustedTop] >= startHour) {
                        adjustedTop += 5; // Increment by 5% until finding a free slot
                    }
                    timeSlots[adjustedTop] = endHour;

                    const activityElement = document.createElement('div');
                    activityElement.className = 'activity';
                    activityElement.style.top = `${adjustedTop}%`;
                    activityElement.style.height = `${height}%`;
                    activityElement.innerHTML = `${activity.activityName} (${activity.start_time} - ${activity.end_time}) <button>Button</button>`;
                    dayColumn.appendChild(activityElement);
                }
            });

            // Add hourly markers
            for (let i = 8; i <= 24; i++) {
                const hourMarker = document.createElement('div');
                hourMarker.className = 'hour-marker';
                const markerTop = ((i - 8) * 60) / 960 * 100; // Calculate top position
                hourMarker.style.top = `${markerTop}%`;
                dayColumn.appendChild(hourMarker);
            }
            scheduleBody.appendChild(dayColumn);
        });
    }
</script>
</body>
</html>
